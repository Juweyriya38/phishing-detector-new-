<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Deleted Users</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    :root {
      --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --text-muted: #64748b;
      --border: #e2e8f0; --primary: #3b82f6; --danger: #dc2626; --shadow: rgba(0,0,0,0.1);
    }
    body { font-family: Inter, sans-serif; background: var(--bg); color: var(--text); margin: 0; line-height: 1.6; }
    .header { background: var(--card); box-shadow: 0 2px 8px var(--shadow); padding: 1rem 1.5rem; display: flex; align-items: center; gap: 1rem; position: sticky; top: 0; z-index: 300; }
    .hamburger { background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0.5rem; border-radius: 8px; }
    .hamburger:hover { background: var(--border); }
    .header h1 { margin: 0; font-size: 1.5rem; font-weight: 600; }
    .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100vh; background: var(--card); box-shadow: 2px 0 10px var(--shadow); transition: left 0.3s; z-index: 200; }
    .sidebar.open { left: 0; }
    .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--border); }
    .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.5rem; color: var(--text-muted); text-decoration: none; font-size: 0.875rem; transition: all 0.2s; border-left: 3px solid transparent; }
    .nav-item:hover { background: var(--border); color: var(--text); }
    .nav-item.active { background: rgba(59, 130, 246, 0.1); color: var(--primary); border-left-color: var(--primary); }
    .nav-item.logout { color: var(--danger); }
    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); opacity: 0; visibility: hidden; transition: all 0.3s; z-index: 150; }
    .overlay.active { opacity: 1; visibility: visible; }
    .main-content { padding: 1.5rem; transition: margin-left 0.3s; }
    .container { max-width: 1200px; margin: 0 auto; }
    .card { background: var(--card); border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; }
    .empty-state { text-align: center; padding: 3rem 1.5rem; color: var(--text-muted); }
    .empty-state-icon { font-size: 3rem; margin-bottom: 1rem; }
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
    th { background: var(--border); font-weight: 600; padding: 1rem; text-align: left; border-bottom: 1px solid var(--border); }
    td { padding: 1rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
    tr:hover { background: var(--border); }
    .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); }
    .badge { display: inline-block; padding: 0.25rem 0.75rem; background: var(--border); border-radius: 12px; font-size: 0.75rem; font-weight: 500; }
    .badge.admin { background: #fef3c7; color: #d97706; }
    .badge.user { background: #dbeafe; color: var(--primary); }
    .text-muted { color: var(--text-muted); font-size: 0.875rem; }
    .mobile-cards { display: none; padding: 1rem; }
    .user-card { background: var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem; }
    .user-card .info h3 { margin-bottom: 0.25rem; font-size: 1rem; }
    .user-card .info p { margin: 0.125rem 0; font-size: 0.875rem; color: var(--text-muted); }
    @media (max-width: 768px) { .table-container { display: none; } .mobile-cards { display: block; } }
    @media (min-width: 1024px) { .hamburger { display: none; } .sidebar { left: 0; } .header { margin-left: 280px; } .main-content { margin-left: 280px; } .overlay { display: none; } }
  </style>
</head>
<body>
  <header class="header">
    <button class="hamburger" id="hamburger">‚ò∞</button>
    <h1>üóëÔ∏è Deleted Users</h1>
  </header>
  
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header"><h2>Navigation</h2></div>
    <div>
      <a href="/admin/home" class="nav-item"><span>üè†</span> Dashboard</a>
      <a href="/admin/users" class="nav-item"><span>üë•</span> Users</a>
      <a href="/admin/trash" class="nav-item active"><span>üóëÔ∏è</span> Deleted Users</a>
      <a href="/admin/logout" class="nav-item logout"><span>üö™</span> Logout</a>
    </div>
  </nav>
  
  <div class="overlay" id="overlay"></div>
  
  <div class="main-content">
    <div class="container">
      <div class="card">
        <div class="table-container">
          <table>
            <thead>
              <tr><th>ID</th><th>Avatar</th><th>Username</th><th>Email</th><th>Reason</th><th>Deleted At</th></tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
        <div class="mobile-cards" id="mobileCards"></div>
        <div class="empty-state" id="emptyState">
          <div class="empty-state-icon">üóëÔ∏è</div>
          <h3>No Deleted Users</h3>
          <p>The trash is empty. Deleted users will appear here.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    
    function toggleSidebar() {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
    }
    
    hamburger.addEventListener('click', toggleSidebar);
    overlay.addEventListener('click', toggleSidebar);
    
    function formatDate(dateString) {
      if (!dateString) return 'Unknown';
      try {
        const date = new Date(dateString);
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      } catch { return dateString; }
    }
    
    function getAvatarUrl(profileImage) {
      return profileImage ? `/static/${profileImage}` : '/static/assets/default-avatar.png';
    }
    
    async function loadTrash() {
      try {
        const response = await fetch('/admin/trash/list', {credentials: 'include'});
        if (!response.ok) {
          if (response.status === 401) { window.location.href = '/admin'; return; }
          throw new Error('Failed to load deleted users');
        }
        
        const data = await response.json();
        const deletedUsers = data.deleted_users || [];
        const tbody = document.getElementById('tbody');
        const mobileCards = document.getElementById('mobileCards');
        const emptyState = document.getElementById('emptyState');
        
        if (deletedUsers.length === 0) {
          tbody.innerHTML = '';
          mobileCards.innerHTML = '';
          emptyState.style.display = 'block';
        } else {
          emptyState.style.display = 'none';
          tbody.innerHTML = deletedUsers.map(user => `
            <tr>
              <td><strong>${user.id || ''}</strong></td>
              <td><img src="${getAvatarUrl(user.profile_image)}" alt="${user.username || 'User'} avatar" class="avatar" onerror="this.src='/static/assets/default-avatar.png'"></td>
              <td>${user.username || '<em>No username</em>'}</td>
              <td>${user.email || '<em>No email</em>'}</td>
              <td><span class="badge ${user.deleted_reason === 'admin' ? 'admin' : 'user'}">${user.deleted_reason || 'user'}</span></td>
              <td class="text-muted">${formatDate(user.deleted_at)}</td>
            </tr>
          `).join('');
          mobileCards.innerHTML = deletedUsers.map(user => `
            <div class="user-card">
              <img src="${getAvatarUrl(user.profile_image)}" alt="${user.username || 'User'} avatar" class="avatar" onerror="this.src='/static/assets/default-avatar.png'">
              <div class="info">
                <h3>${user.username || 'No username'} <small>(ID: ${user.id})</small></h3>
                <p><strong>Email:</strong> ${user.email || 'No email'}</p>
                <p><strong>Deleted:</strong> ${formatDate(user.deleted_at)}</p>
                <p><strong>Reason:</strong> <span class="badge ${user.deleted_reason === 'admin' ? 'admin' : 'user'}">${user.deleted_reason || 'user'}</span></p>
              </div>
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('Error loading deleted users:', error);
        document.getElementById('tbody').innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--danger);padding:2rem;"><strong>Error loading deleted users</strong><br><small>Please refresh the page to try again</small></td></tr>';
      }
    }
    
    document.addEventListener('DOMContentLoaded', loadTrash);
  </script>
</body>
</html>